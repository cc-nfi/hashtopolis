name: Hashtopolis

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Start application containers
        working-directory: .devcontainer
        run: docker compose up -d
      - name: Wait until entrypoint is finished and Hashtopolis is started
        run: bash .github/scripts/await-hashtopolis-startup.sh
      - name: Give Apache permissions on necessary directories # for the tests, only src/files and src/inc/utils/locks seem necessary
        run: docker exec hashtopolis chown -R www-data:www-data /var/www/html/src
      - name: Run test suite
        run: docker exec hashtopolis php ci/run.php -vmaster